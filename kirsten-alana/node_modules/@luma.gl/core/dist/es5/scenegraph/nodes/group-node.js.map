{"version":3,"sources":["../../../../src/scenegraph/nodes/group-node.js"],"names":["GroupNode","props","Array","isArray","children","every","child","ScenegraphNode","add","push","indexOf","splice","forEach","removeAll","visitor","worldMatrix","Matrix4","modelMatrix","multiplyRight","matrix","traverse","opts","log","warn"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;IAEqBA,S;;;AACnB,uBAAwB;AAAA;;AAAA,QAAZC,KAAY,uEAAJ,EAAI;AAAA;AACtBA,IAAAA,KAAK,GAAGC,KAAK,CAACC,OAAN,CAAcF,KAAd,IAAuB;AAACG,MAAAA,QAAQ,EAAEH;AAAX,KAAvB,GAA2CA,KAAnD;AADsB,iBAEEA,KAFF;AAAA,iCAEfG,QAFe;AAAA,QAEfA,QAFe,gCAEJ,EAFI;AAGtBA,IAAAA,QAAQ,CAACC,KAAT,CAAe,UAAAC,KAAK;AAAA,aAAI,mBAAOA,KAAK,YAAYC,0BAAxB,CAAJ;AAAA,KAApB;AACA,qHAAMN,KAAN;AACA,UAAKG,QAAL,GAAgBA,QAAhB;AALsB;AAMvB;;;;0BAGgB;AAAA,wCAAVA,QAAU;AAAVA,QAAAA,QAAU;AAAA;;AACf,mCAAoBA,QAApB,+BAA8B;AAAzB,YAAME,KAAK,gBAAX;;AACH,YAAIJ,KAAK,CAACC,OAAN,CAAcG,KAAd,CAAJ,EAA0B;AACxB,eAAKE,GAAL,iDAAYF,KAAZ;AACD,SAFD,MAEO;AACL,eAAKF,QAAL,CAAcK,IAAd,CAAmBH,KAAnB;AACD;AACF;;AACD,aAAO,IAAP;AACD;;;2BAEMA,K,EAAO;AACZ,UAAMF,QAAQ,GAAG,KAAKA,QAAtB;AACA,UAAMM,OAAO,GAAGN,QAAQ,CAACM,OAAT,CAAiBJ,KAAjB,CAAhB;;AACA,UAAII,OAAO,GAAG,CAAC,CAAf,EAAkB;AAChBN,QAAAA,QAAQ,CAACO,MAAT,CAAgBD,OAAhB,EAAyB,CAAzB;AACD;;AACD,aAAO,IAAP;AACD;;;gCAEW;AACV,WAAKN,QAAL,GAAgB,EAAhB;AACA,aAAO,IAAP;AACD;;;8BAEQ;AACP,WAAKA,QAAL,CAAcQ,OAAd,CAAsB,UAAAN,KAAK;AAAA,eAAIA,KAAK,UAAL,EAAJ;AAAA,OAA3B;AACA,WAAKO,SAAL;AACA;AACD;;;6BAEQC,O,EAA6C;AAAA,qFAAJ,EAAI;AAAA,kCAAnCC,WAAmC;AAAA,UAAnCA,WAAmC,iCAArB,IAAIC,aAAJ,EAAqB;;AACpD,UAAMC,WAAW,GAAG,IAAID,aAAJ,CAAYD,WAAZ,EAAyBG,aAAzB,CAAuC,KAAKC,MAA5C,CAApB;AADoD;AAAA;AAAA;;AAAA;AAGpD,6BAAoB,KAAKf,QAAzB,8HAAmC;AAAA,cAAxBE,KAAwB;;AACjC,cAAIA,KAAK,YAAYN,SAArB,EAAgC;AAC9BM,YAAAA,KAAK,CAACc,QAAN,CAAeN,OAAf,EAAwB;AAACC,cAAAA,WAAW,EAAEE;AAAd,aAAxB;AACD,WAFD,MAEO;AACLH,YAAAA,OAAO,CAACR,KAAD,EAAQ;AAACS,cAAAA,WAAW,EAAEE;AAAd,aAAR,CAAP;AACD;AACF;AATmD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUrD;;;oCAEeH,O,EAASO,I,EAAM;AAC7BC,iBAAIC,IAAJ,CAAS,gCAAT;;AACA,aAAO,KAAKH,QAAL,CAAcN,OAAd,EAAuBO,IAAvB,CAAP;AACD;;;EAxDoCd,0B","sourcesContent":["import {Matrix4} from 'math.gl';\nimport {log, assert} from '../../utils';\nimport ScenegraphNode from './scenegraph-node';\n\nexport default class GroupNode extends ScenegraphNode {\n  constructor(props = {}) {\n    props = Array.isArray(props) ? {children: props} : props;\n    const {children = []} = props;\n    children.every(child => assert(child instanceof ScenegraphNode));\n    super(props);\n    this.children = children;\n  }\n\n  // Unpacks arrays and nested arrays of children\n  add(...children) {\n    for (const child of children) {\n      if (Array.isArray(child)) {\n        this.add(...child);\n      } else {\n        this.children.push(child);\n      }\n    }\n    return this;\n  }\n\n  remove(child) {\n    const children = this.children;\n    const indexOf = children.indexOf(child);\n    if (indexOf > -1) {\n      children.splice(indexOf, 1);\n    }\n    return this;\n  }\n\n  removeAll() {\n    this.children = [];\n    return this;\n  }\n\n  delete() {\n    this.children.forEach(child => child.delete());\n    this.removeAll();\n    super.delete();\n  }\n\n  traverse(visitor, {worldMatrix = new Matrix4()} = {}) {\n    const modelMatrix = new Matrix4(worldMatrix).multiplyRight(this.matrix);\n\n    for (const child of this.children) {\n      if (child instanceof GroupNode) {\n        child.traverse(visitor, {worldMatrix: modelMatrix});\n      } else {\n        visitor(child, {worldMatrix: modelMatrix});\n      }\n    }\n  }\n\n  traverseReverse(visitor, opts) {\n    log.warn('traverseReverse is not reverse')();\n    return this.traverse(visitor, opts);\n  }\n}\n"],"file":"group-node.js"}