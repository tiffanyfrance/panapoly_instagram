{"version":3,"sources":["../../../../src/scenegraph/nodes/group-node.js"],"names":["Matrix4","log","assert","ScenegraphNode","GroupNode","constructor","props","Array","isArray","children","every","child","add","push","remove","indexOf","splice","removeAll","delete","forEach","traverse","visitor","worldMatrix","modelMatrix","multiplyRight","matrix","traverseReverse","opts","warn"],"mappings":"AAAA,SAAQA,OAAR,QAAsB,SAAtB;AACA,SAAQC,GAAR,EAAaC,MAAb,QAA0B,aAA1B;AACA,OAAOC,cAAP,MAA2B,mBAA3B;AAEA,eAAe,MAAMC,SAAN,SAAwBD,cAAxB,CAAuC;AACpDE,EAAAA,WAAW,GAAa;AAAA,QAAZC,KAAY,uEAAJ,EAAI;AACtBA,IAAAA,KAAK,GAAGC,KAAK,CAACC,OAAN,CAAcF,KAAd,IAAuB;AAACG,MAAAA,QAAQ,EAAEH;AAAX,KAAvB,GAA2CA,KAAnD;AADsB,mBAEEA,KAFF;AAAA,mCAEfG,QAFe;AAAA,UAEfA,QAFe,gCAEJ,EAFI;AAGtBA,IAAAA,QAAQ,CAACC,KAAT,CAAeC,KAAK,IAAIT,MAAM,CAACS,KAAK,YAAYR,cAAlB,CAA9B;AACA,UAAMG,KAAN;AACA,SAAKG,QAAL,GAAgBA,QAAhB;AACD;;AAGDG,EAAAA,GAAG,GAAc;AAAA,sCAAVH,QAAU;AAAVA,MAAAA,QAAU;AAAA;;AACf,SAAK,MAAME,KAAX,IAAoBF,QAApB,EAA8B;AAC5B,UAAIF,KAAK,CAACC,OAAN,CAAcG,KAAd,CAAJ,EAA0B;AACxB,aAAKC,GAAL,CAAS,GAAGD,KAAZ;AACD,OAFD,MAEO;AACL,aAAKF,QAAL,CAAcI,IAAd,CAAmBF,KAAnB;AACD;AACF;;AACD,WAAO,IAAP;AACD;;AAEDG,EAAAA,MAAM,CAACH,KAAD,EAAQ;AACZ,UAAMF,QAAQ,GAAG,KAAKA,QAAtB;AACA,UAAMM,OAAO,GAAGN,QAAQ,CAACM,OAAT,CAAiBJ,KAAjB,CAAhB;;AACA,QAAII,OAAO,GAAG,CAAC,CAAf,EAAkB;AAChBN,MAAAA,QAAQ,CAACO,MAAT,CAAgBD,OAAhB,EAAyB,CAAzB;AACD;;AACD,WAAO,IAAP;AACD;;AAEDE,EAAAA,SAAS,GAAG;AACV,SAAKR,QAAL,GAAgB,EAAhB;AACA,WAAO,IAAP;AACD;;AAEDS,EAAAA,MAAM,GAAG;AACP,SAAKT,QAAL,CAAcU,OAAd,CAAsBR,KAAK,IAAIA,KAAK,CAACO,MAAN,EAA/B;AACA,SAAKD,SAAL;AACA,UAAMC,MAAN;AACD;;AAEDE,EAAAA,QAAQ,CAACC,OAAD,EAA8C;AAAA,mFAAJ,EAAI;AAAA,gCAAnCC,WAAmC;AAAA,QAAnCA,WAAmC,iCAArB,IAAItB,OAAJ,EAAqB;;AACpD,UAAMuB,WAAW,GAAG,IAAIvB,OAAJ,CAAYsB,WAAZ,EAAyBE,aAAzB,CAAuC,KAAKC,MAA5C,CAApB;;AAEA,SAAK,MAAMd,KAAX,IAAoB,KAAKF,QAAzB,EAAmC;AACjC,UAAIE,KAAK,YAAYP,SAArB,EAAgC;AAC9BO,QAAAA,KAAK,CAACS,QAAN,CAAeC,OAAf,EAAwB;AAACC,UAAAA,WAAW,EAAEC;AAAd,SAAxB;AACD,OAFD,MAEO;AACLF,QAAAA,OAAO,CAACV,KAAD,EAAQ;AAACW,UAAAA,WAAW,EAAEC;AAAd,SAAR,CAAP;AACD;AACF;AACF;;AAEDG,EAAAA,eAAe,CAACL,OAAD,EAAUM,IAAV,EAAgB;AAC7B1B,IAAAA,GAAG,CAAC2B,IAAJ,CAAS,gCAAT;AACA,WAAO,KAAKR,QAAL,CAAcC,OAAd,EAAuBM,IAAvB,CAAP;AACD;;AAxDmD","sourcesContent":["import {Matrix4} from 'math.gl';\nimport {log, assert} from '../../utils';\nimport ScenegraphNode from './scenegraph-node';\n\nexport default class GroupNode extends ScenegraphNode {\n  constructor(props = {}) {\n    props = Array.isArray(props) ? {children: props} : props;\n    const {children = []} = props;\n    children.every(child => assert(child instanceof ScenegraphNode));\n    super(props);\n    this.children = children;\n  }\n\n  // Unpacks arrays and nested arrays of children\n  add(...children) {\n    for (const child of children) {\n      if (Array.isArray(child)) {\n        this.add(...child);\n      } else {\n        this.children.push(child);\n      }\n    }\n    return this;\n  }\n\n  remove(child) {\n    const children = this.children;\n    const indexOf = children.indexOf(child);\n    if (indexOf > -1) {\n      children.splice(indexOf, 1);\n    }\n    return this;\n  }\n\n  removeAll() {\n    this.children = [];\n    return this;\n  }\n\n  delete() {\n    this.children.forEach(child => child.delete());\n    this.removeAll();\n    super.delete();\n  }\n\n  traverse(visitor, {worldMatrix = new Matrix4()} = {}) {\n    const modelMatrix = new Matrix4(worldMatrix).multiplyRight(this.matrix);\n\n    for (const child of this.children) {\n      if (child instanceof GroupNode) {\n        child.traverse(visitor, {worldMatrix: modelMatrix});\n      } else {\n        visitor(child, {worldMatrix: modelMatrix});\n      }\n    }\n  }\n\n  traverseReverse(visitor, opts) {\n    log.warn('traverseReverse is not reverse')();\n    return this.traverse(visitor, opts);\n  }\n}\n"],"file":"group-node.js"}