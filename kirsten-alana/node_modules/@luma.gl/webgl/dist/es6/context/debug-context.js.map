{"version":3,"sources":["../../../src/context/debug-context.js"],"names":["global","log","getContextData","gl","luma","enableDebug","debug","makeDebugContext","getDebugContext","getRealContext","data","realContext","WebGLDebug","console","warn","debugContext","WebGLDebugContext","onGLError","onValidateGLFunc","Object","assign","prototype","getFunctionString","functionName","functionArgs","args","glFunctionArgsToString","slice","length","err","errorMessage","glEnumToString","message","error","functionString","priority","break","isBreakpoint","every","breakOn","indexOf","arg","undefined","throw","Error"],"mappings":"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","sourcesContent":["// Depends on Khronos Debug support module being imported via \"luma.gl/debug\"\n\nimport {global} from '../utils/globals';\nimport {log} from '../utils';\n\n// Helper to get shared context data\nfunction getContextData(gl) {\n  gl.luma = gl.luma || {};\n  return gl.luma;\n}\n\n// Enable or disable debug checks in debug contexts\n// Non-debug contexts do not have checks (to ensure performance)\n// Turning off debug for debug contexts removes most of the performance penalty\nexport function enableDebug(debug) {\n  // log.debug = debug;\n}\n\n// Returns (a potentially new) context with debug instrumentation turned off or on.\n// Note that this actually returns a new context\nexport function makeDebugContext(gl, {debug = true} = {}) {\n  if (gl === null) {\n    // Return to ensure we don't create a context in this case.\n    return null;\n  }\n\n  return debug ? getDebugContext(gl) : getRealContext(gl);\n}\n\n// Returns the real context from either of the real/debug contexts\nexport function getRealContext(gl) {\n  if (gl === null) {\n    // Return to ensure we don't create a context in this case.\n    return null;\n  }\n\n  const data = getContextData(gl);\n  // If the context has a realContext member, it is a debug context so return the realContext\n  return data.realContext ? data.realContext : gl;\n}\n\n// Returns the debug context from either of the real/debug contexts\nexport function getDebugContext(gl) {\n  if (gl === null) {\n    // Return to ensure we don't create a context in this case.\n    return null;\n  }\n\n  if (!global.WebGLDebug) {\n    // eslint-disable-next-line\n    console.warn('WebGL debug mode not activated. import \"@luma.gl/debug\" to enable.')();\n    return gl;\n  }\n\n  const data = getContextData(gl);\n  // If this *is* a debug context, return itself\n  if (data.realContext) {\n    return gl;\n  }\n\n  // If this already has a debug context, return it.\n  if (data.debugContext) {\n    return data.debugContext;\n  }\n\n  // Create a new debug context\n  class WebGLDebugContext {}\n  const debugContext = global.WebGLDebug\n    ? global.WebGLDebug.makeDebugContext(gl, onGLError, onValidateGLFunc)\n    : gl;\n  Object.assign(WebGLDebugContext.prototype, debugContext);\n\n  // Store the debug context\n  data.debugContext = debugContext;\n  debugContext.debug = true;\n  debugContext.gl = gl;\n\n  // log.info('debug context actived.')();\n\n  // Return it\n  return debugContext;\n}\n\n// DEBUG TRACING\n\nfunction getFunctionString(functionName, functionArgs) {\n  let args = global.WebGLDebug.glFunctionArgsToString(functionName, functionArgs);\n  args = `${args.slice(0, 100)}${args.length > 100 ? '...' : ''}`;\n  return `gl.${functionName}(${args})`;\n}\n\nfunction onGLError(err, functionName, args) {\n  const errorMessage = global.WebGLDebug.glEnumToString(err);\n  const functionArgs = global.WebGLDebug.glFunctionArgsToString(functionName, args);\n  const message = `${errorMessage} in gl.${functionName}(${functionArgs})`;\n  // if (false) { // log.throw) {\n  //   throw new Error(message);\n  // } else {\n  log.error(message)();\n  debugger; // eslint-disable-line\n  // }\n}\n\n// Don't generate function string until it is needed\nfunction onValidateGLFunc(functionName, functionArgs) {\n  let functionString;\n  if (log.priority >= 4) {\n    functionString = getFunctionString(functionName, functionArgs);\n    log.log(4, functionString)();\n  }\n\n  if (log.break) {\n    functionString = functionString || getFunctionString(functionName, functionArgs);\n    const isBreakpoint =\n      log.break && log.break.every(breakOn => functionString.indexOf(breakOn) !== -1);\n    if (isBreakpoint) {\n      debugger; // eslint-disable-line\n    }\n  }\n\n  for (const arg of functionArgs) {\n    if (arg === undefined) {\n      functionString = functionString || getFunctionString(functionName, functionArgs);\n      if (log.throw) {\n        throw new Error(`Undefined argument: ${functionString}`);\n      } else {\n        log.error(`Undefined argument: ${functionString}`)();\n        log.error(`Undefined argument: ${functionString}`)();\n        debugger; // eslint-disable-line\n      }\n    }\n  }\n}\n"],"file":"debug-context.js"}