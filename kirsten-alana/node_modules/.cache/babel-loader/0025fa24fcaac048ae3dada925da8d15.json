{"ast":null,"code":"import { createIterable } from '@deck.gl/core';\nvar RADIAN_PER_DEGREE = Math.PI / 180;\nvar modelMatrix = new Float32Array(16);\nvar valueArray = new Float32Array(12);\n\nfunction calculateTransformMatrix(targetMatrix, orientation, scale) {\n  var pitch = orientation[0] * RADIAN_PER_DEGREE;\n  var yaw = orientation[1] * RADIAN_PER_DEGREE;\n  var roll = orientation[2] * RADIAN_PER_DEGREE;\n  var sr = Math.sin(roll);\n  var sp = Math.sin(pitch);\n  var sw = Math.sin(yaw);\n  var cr = Math.cos(roll);\n  var cp = Math.cos(pitch);\n  var cw = Math.cos(yaw);\n  var scx = scale[0];\n  var scy = scale[1];\n  var scz = scale[2];\n  targetMatrix[0] = scx * cw * cp;\n  targetMatrix[1] = scx * sw * cp;\n  targetMatrix[2] = scx * -sp;\n  targetMatrix[3] = scy * (-sw * cr + cw * sp * sr);\n  targetMatrix[4] = scy * (cw * cr + sw * sp * sr);\n  targetMatrix[5] = scy * cp * sr;\n  targetMatrix[6] = scz * (sw * sr + cw * sp * cr);\n  targetMatrix[7] = scz * (-cw * sr + sw * sp * cr);\n  targetMatrix[8] = scz * cp * cr;\n}\n\nfunction getExtendedMat3FromMat4(mat4) {\n  mat4[0] = mat4[0];\n  mat4[1] = mat4[1];\n  mat4[2] = mat4[2];\n  mat4[3] = mat4[4];\n  mat4[4] = mat4[5];\n  mat4[5] = mat4[6];\n  mat4[6] = mat4[8];\n  mat4[7] = mat4[9];\n  mat4[8] = mat4[10];\n  mat4[9] = mat4[12];\n  mat4[10] = mat4[13];\n  mat4[11] = mat4[14];\n  return mat4.subarray(0, 12);\n}\n\nexport var MATRIX_ATTRIBUTES = {\n  size: 12,\n  accessor: ['getOrientation', 'getScale', 'getTranslation', 'getTransformMatrix'],\n  shaderAttributes: {\n    instanceModelMatrix__LOCATION_0: {\n      size: 3,\n      stride: 48,\n      offset: 0\n    },\n    instanceModelMatrix__LOCATION_1: {\n      size: 3,\n      stride: 48,\n      offset: 12\n    },\n    instanceModelMatrix__LOCATION_2: {\n      size: 3,\n      stride: 48,\n      offset: 24\n    },\n    instanceTranslation: {\n      size: 3,\n      stride: 48,\n      offset: 36\n    }\n  },\n  update: function update(attribute) {\n    var _this$props = this.props,\n        data = _this$props.data,\n        getOrientation = _this$props.getOrientation,\n        getScale = _this$props.getScale,\n        getTranslation = _this$props.getTranslation,\n        getTransformMatrix = _this$props.getTransformMatrix;\n    var arrayMatrix = Array.isArray(getTransformMatrix);\n    var constantMatrix = arrayMatrix && getTransformMatrix.length === 16;\n    var constantScale = Array.isArray(getScale);\n    var constantOrientation = Array.isArray(getOrientation);\n    var constantTranslation = Array.isArray(getTranslation);\n    var hasMatrix = constantMatrix || !arrayMatrix && Boolean(getTransformMatrix(data[0]));\n\n    if (hasMatrix) {\n      attribute.constant = constantMatrix;\n    } else {\n      attribute.constant = constantOrientation && constantScale && constantTranslation;\n    }\n\n    var instanceModelMatrixData = attribute.value;\n\n    if (attribute.constant) {\n      var matrix;\n\n      if (hasMatrix) {\n        modelMatrix.set(getTransformMatrix);\n        matrix = getExtendedMat3FromMat4(modelMatrix);\n      } else {\n        matrix = valueArray;\n        var orientation = getOrientation;\n        var scale = getScale;\n        calculateTransformMatrix(matrix, orientation, scale);\n        matrix.set(getTranslation, 9);\n      }\n\n      attribute.value = new Float32Array(matrix);\n    } else {\n      var i = 0;\n\n      var _createIterable = createIterable(data),\n          iterable = _createIterable.iterable,\n          objectInfo = _createIterable.objectInfo;\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = iterable[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var object = _step.value;\n          objectInfo.index++;\n\n          var _matrix = void 0;\n\n          if (hasMatrix) {\n            modelMatrix.set(constantMatrix ? getTransformMatrix : getTransformMatrix(object, objectInfo));\n            _matrix = getExtendedMat3FromMat4(modelMatrix);\n          } else {\n            _matrix = valueArray;\n\n            var _orientation = constantOrientation ? getOrientation : getOrientation(object, objectInfo);\n\n            var _scale = constantScale ? getScale : getScale(object, objectInfo);\n\n            calculateTransformMatrix(_matrix, _orientation, _scale);\n\n            _matrix.set(constantTranslation ? getTranslation : getTranslation(object, objectInfo), 9);\n          }\n\n          instanceModelMatrixData[i++] = _matrix[0];\n          instanceModelMatrixData[i++] = _matrix[1];\n          instanceModelMatrixData[i++] = _matrix[2];\n          instanceModelMatrixData[i++] = _matrix[3];\n          instanceModelMatrixData[i++] = _matrix[4];\n          instanceModelMatrixData[i++] = _matrix[5];\n          instanceModelMatrixData[i++] = _matrix[6];\n          instanceModelMatrixData[i++] = _matrix[7];\n          instanceModelMatrixData[i++] = _matrix[8];\n          instanceModelMatrixData[i++] = _matrix[9];\n          instanceModelMatrixData[i++] = _matrix[10];\n          instanceModelMatrixData[i++] = _matrix[11];\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return != null) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module"}