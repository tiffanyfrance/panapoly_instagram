import getTransferList from './get-transfer-list';
export default function createWorker(loader) {
  if (typeof self === 'undefined') {
    return;
  }

  self.onmessage = evt => {
    const _evt$data = evt.data,
          arraybuffer = _evt$data.arraybuffer,
          opts = _evt$data.opts;

    try {
      let data;
      let parser;

      if (loader.parseSync) {
        data = arraybuffer;
        parser = loader.parseSync;
      } else if (loader.parseTextSync) {
        const textDecoder = new TextDecoder();
        data = textDecoder.decode(arraybuffer);
        parser = loader.parseTextSync;
      } else {
        throw new Error("Could not load data with ".concat(loader.name, " loader"));
      }

      const result = parser(data, opts);
      const transferList = getTransferList(result);
      self.postMessage({
        type: 'done',
        result
      }, transferList);
    } catch (error) {
      self.postMessage({
        type: 'error',
        message: error.message
      });
    }
  };
}
//# sourceMappingURL=create-worker.js.map