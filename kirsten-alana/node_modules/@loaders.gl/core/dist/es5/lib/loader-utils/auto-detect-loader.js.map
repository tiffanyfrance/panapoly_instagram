{"version":3,"sources":["../../../../src/lib/loader-utils/auto-detect-loader.js"],"names":["EXT_PATTERN","autoDetectLoader","url","text","loaders","match","extension","loader","findLoaderByExtension","findLoaderByExamingInitialData","toLowerCase","extensions","loaderExtension","testText"],"mappings":";;;;;;;AAAA;;AAEA,IAAMA,WAAW,GAAG,SAApB;;AAIO,SAASC,gBAAT,GAAmD;AAAA,MAAzBC,GAAyB,uEAAnB,EAAmB;AAAA,MAAfC,IAAe;AAAA,MAATC,OAAS;AAIxD,MAAMC,KAAK,GAAGH,GAAG,CAACG,KAAJ,CAAUL,WAAV,CAAd;;AACA,MAAIK,KAAK,IAAIA,KAAK,CAAC,CAAD,CAAlB,EAAuB;AACrB,QAAMC,SAAS,GAAGD,KAAK,CAAC,CAAD,CAAvB;;AACA,QAAME,OAAM,GAAGC,qBAAqB,CAACJ,OAAD,EAAUE,SAAV,CAApC;;AACA,QAAIC,OAAJ,EAAY;AACV,aAAOA,OAAP;AACD;AACF;;AAED,MAAMA,MAAM,GAAGE,8BAA8B,CAACL,OAAD,EAAUD,IAAV,CAA7C;;AACA,MAAII,MAAJ,EAAY;AACV,WAAOA,MAAP;AACD;;AAED,SAAO,IAAP;AACD;;AAED,SAASC,qBAAT,CAA+BJ,OAA/B,EAAwCE,SAAxC,EAAmD;AACjDA,EAAAA,SAAS,GAAGA,SAAS,CAACI,WAAV,EAAZ;AADiD;AAAA;AAAA;;AAAA;AAGjD,yBAAqBN,OAArB,8HAA8B;AAAA,UAAnBG,MAAmB;AAC5B,4CAAgBA,MAAhB;AAD4B;AAAA;AAAA;;AAAA;AAE5B,8BAA8BA,MAAM,CAACI,UAArC,mIAAiD;AAAA,cAAtCC,eAAsC;;AAC/C,cAAIA,eAAe,CAACF,WAAhB,OAAkCJ,SAAtC,EAAiD;AAC/C,mBAAOC,MAAP;AACD;AACF;AAN2B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAO7B;AAVgD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAWjD,SAAO,IAAP;AACD;;AAED,SAASE,8BAAT,CAAwCL,OAAxC,EAAiDD,IAAjD,EAAuD;AAAA;AAAA;AAAA;;AAAA;AACrD,0BAAqBC,OAArB,mIAA8B;AAAA,UAAnBG,MAAmB;;AAC5B,UAAIA,MAAM,CAACM,QAAP,IAAmBN,MAAM,CAACM,QAAP,CAAgBV,IAAhB,CAAvB,EAA8C;AAC5C,eAAOI,MAAP;AACD;AACF;AALoD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAMrD,SAAO,IAAP;AACD","sourcesContent":["import {normalizeLoader} from './normalize-loader';\n\nconst EXT_PATTERN = /[^\\.]+$/;\n\n// Find a loader that works for extension/text\n// Search the loaders array argument for a loader that matches extension or text\nexport function autoDetectLoader(url = '', text, loaders) {\n  // Get extension\n  // TODO - Would be nice to support http://example.com/file.glb?parameter=1\n  // E.g: x = new URL('http://example.com/file.glb?load=1'; x.pathname\n  const match = url.match(EXT_PATTERN);\n  if (match && match[0]) {\n    const extension = match[0];\n    const loader = findLoaderByExtension(loaders, extension);\n    if (loader) {\n      return loader;\n    }\n  }\n\n  const loader = findLoaderByExamingInitialData(loaders, text);\n  if (loader) {\n    return loader;\n  }\n\n  return null;\n}\n\nfunction findLoaderByExtension(loaders, extension) {\n  extension = extension.toLowerCase();\n\n  for (const loader of loaders) {\n    normalizeLoader(loader);\n    for (const loaderExtension of loader.extensions) {\n      if (loaderExtension.toLowerCase() === extension) {\n        return loader;\n      }\n    }\n  }\n  return null;\n}\n\nfunction findLoaderByExamingInitialData(loaders, text) {\n  for (const loader of loaders) {\n    if (loader.testText && loader.testText(text)) {\n      return loader;\n    }\n  }\n  return null;\n}\n"],"file":"auto-detect-loader.js"}