{"version":3,"sources":["../../../../src/lib/loader-utils/get-data.js"],"names":["isFetchResponse","isReadableStream","isAsyncIterable","isIterable","isIterator","getStreamIterator","TextDecoder","ERR_DATA","getUrlFromData","data","url","getSizeFromData","headers","get","getArrayBufferOrStringFromDataSync","loader","text","ArrayBuffer","isView","arrayBuffer","buffer","binary","textDecoder","decode","Error","getArrayBufferOrStringFromData","isArrayBuffer","getAsyncIteratorFromData","body","Symbol","asyncIterator","getIteratorFromData","oneChunk","iterator"],"mappings":"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","sourcesContent":["import {\n  isFetchResponse,\n  isReadableStream,\n  isAsyncIterable,\n  isIterable,\n  isIterator\n} from '../../javascript-utils/is-type';\nimport {getStreamIterator} from '../../javascript-utils/stream-utils';\nimport {TextDecoder} from '../../javascript-utils/text-encoding';\n\nconst ERR_DATA = 'Cannot convert supplied data type';\n\nexport function getUrlFromData(data) {\n  return isFetchResponse(data) ? data.url : null;\n}\n\nexport function getSizeFromData(data) {\n  return isFetchResponse(data) ? data.headers.get('Content-Length') : null;\n}\nexport function getArrayBufferOrStringFromDataSync(data, loader) {\n  if (loader.text && typeof data === 'string') {\n    return data;\n  }\n\n  if (data instanceof ArrayBuffer || ArrayBuffer.isView(data)) {\n    const arrayBuffer = data.buffer || data;\n    if (loader.text && !loader.binary) {\n      const textDecoder = new TextDecoder('utf8');\n      return textDecoder.decode(arrayBuffer);\n    }\n    return arrayBuffer;\n  }\n\n  throw new Error(ERR_DATA);\n}\n\n// Convert async iterator to a promise\nexport async function getArrayBufferOrStringFromData(data, loader) {\n  // Resolve any promise\n  data = await data;\n\n  const isArrayBuffer = data instanceof ArrayBuffer || ArrayBuffer.isView(data);\n  if (typeof data === 'string' || isArrayBuffer) {\n    return getArrayBufferOrStringFromDataSync(data, loader);\n  }\n\n  if (isFetchResponse(data)) {\n    return loader.binary ? await data.arrayBuffer() : data.text();\n  }\n\n  // if (isIterable(data) || isAsyncIterable(data)) {\n  // }\n\n  // Assume arrayBuffer iterator - attempt to concatenate\n  // return concatenateAsyncIterator(data);\n\n  throw new Error(ERR_DATA);\n}\n\nexport async function getAsyncIteratorFromData(data, loader) {\n  if (isIterator(data)) {\n    return data;\n  }\n\n  if (isFetchResponse(data)) {\n    return getStreamIterator(data.body);\n  }\n\n  if (isReadableStream(data)) {\n    return getStreamIterator(data);\n  }\n\n  if (isAsyncIterable(data)) {\n    return data[Symbol.asyncIterator]();\n  }\n\n  return getIteratorFromData(data, loader);\n}\n\nexport async function getIteratorFromData(data, loader) {\n  // generate an iterator that emits a single chunk\n  if (data instanceof ArrayBuffer || ArrayBuffer.isView(data)) {\n    return (function* oneChunk() {\n      yield data.buffer || data;\n    })();\n  }\n\n  if (isIterator(data)) {\n    return data;\n  }\n\n  if (isIterable(data)) {\n    return data[Symbol.iterator]();\n  }\n\n  throw new Error(ERR_DATA);\n}\n"],"file":"get-data.js"}